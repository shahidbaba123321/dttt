<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkWise Pro - Super Admin Dashboard</title>
    
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
      /* Root Variables */
:root {
    --primary-color: #4F46E5;
    --secondary-color: #4338CA;
    --success-color: #10B981;
    --warning-color: #F59E0B;
    --danger-color: #EF4444;
    --info-color: #3B82F6;
    --dark-color: #1F2937;
    --light-color: #F3F4F6;
    --white: #FFFFFF;
    --sidebar-width: 260px;
    --header-height: 70px;
    --sidebar-bg: #1E293B;
    --body-bg: #F1F5F9;
    --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
}

/* Global Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Inter', sans-serif;
}

body {
    background-color: var(--body-bg);
    color: var(--dark-color);
    line-height: 1.5;
}

/* Sidebar Styles */
.sidebar {
    position: fixed;
    left: 0;
    top: 0;
    width: var(--sidebar-width);
    height: 100vh;
    background: var(--sidebar-bg);
    color: var(--white);
    overflow-y: auto;
    transition: var(--transition);
    z-index: 1000;
    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
}

.sidebar-header {
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.sidebar-header img {
    width: 40px;
    height: 40px;
    object-fit: contain;
}

.sidebar-header h2 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--white);
}

.nav-menu {
    padding: 1rem 0;
}

.nav-item {
    padding: 0.25rem 1rem;
}

.nav-link {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
    border-radius: 8px;
    transition: var(--transition);
}

.nav-link:hover {
    background: rgba(255, 255, 255, 0.1);
    color: var(--white);
}

.nav-link.active {
    background: var(--primary-color);
    color: var(--white);
}

.nav-link i {
    width: 20px;
    margin-right: 12px;
    font-size: 1.1rem;
}

/* Main Content Area */
.main-content {
    margin-left: var(--sidebar-width);
    padding: var(--header-height) 2rem 2rem;
    min-height: 100vh;
    transition: var(--transition);
}

/* Header Styles */
.header {
    position: fixed;
    top: 0;
    left: var(--sidebar-width);
    right: 0;
    height: var(--header-height);
    background: var(--white);
    padding: 0 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: var(--card-shadow);
    transition: var(--transition);
    z-index: 999;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.menu-toggle {
    display: none;
    background: none;
    border: none;
    color: var(--dark-color);
    font-size: 1.25rem;
    cursor: pointer;
}

.breadcrumb h2 {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--dark-color);
}

.header-right {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.btn {
    padding: 0.5rem 1rem;
    border-radius: 8px;
    border: none;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-outline {
    background: transparent;
    border: 1px solid var(--primary-color);
    color: var(--primary-color);
}

.btn-outline:hover {
    background: var(--primary-color);
    color: var(--white);
}

.notification-bell {
    position: relative;
    padding: 0.5rem;
    cursor: pointer;
}

.notification-bell .badge {
    position: absolute;
    top: 0;
    right: 0;
    background: var(--danger-color);
    color: var(--white);
    font-size: 0.75rem;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 1rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: var(--transition);
}

.user-profile:hover {
    background: var(--light-color);
}

.user-profile img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}

.user-info {
    display: none;
}

@media (min-width: 768px) {
    .user-info {
        display: flex;
        flex-direction: column;
    }

    .user-name {
        font-weight: 600;
        color: var(--dark-color);
    }

    .user-role {
        font-size: 0.875rem;
        color: var(--secondary-color);
    }
}

/* Dashboard Container */
.dashboard-container {
    padding: 1.5rem 0;
}

/* Stats Section */
.stats-section {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: var(--white);
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: var(--card-shadow);
    display: flex;
    align-items: flex-start;
    gap: 1rem;
}

.stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.stat-info {
    flex: 1;
}

.stat-info h3 {
    font-size: 0.875rem;
    color: var(--secondary-color);
    margin-bottom: 0.5rem;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--dark-color);
    margin-bottom: 0.5rem;
}

.stat-change {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
}

.stat-change.positive {
    color: var(--success-color);
}

.stat-change.negative {
    color: var(--danger-color);
}

/* Dashboard Grid */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
}

.dashboard-widget {
    background: var(--white);
    border-radius: 12px;
    box-shadow: var(--card-shadow);
    overflow: hidden;
}

.widget-header {
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--light-color);
}

.widget-header h3 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--dark-color);
}

.widget-actions {
    display: flex;
    gap: 0.5rem;
}

.btn-icon {
    background: none;
    border: none;
    padding: 0.5rem;
    border-radius: 8px;
    cursor: pointer;
    color: var(--secondary-color);
    transition: var(--transition);
}

.btn-icon:hover {
    background: var(--light-color);
}

.widget-content {
    padding: 1.5rem;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .stats-section {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .sidebar {
        transform: translateX(-100%);
    }

    .sidebar.active {
        transform: translateX(0);
    }

    .main-content {
        margin-left: 0;
    }

    .header {
        left: 0;
    }

    .menu-toggle {
        display: block;
    }

    .stats-section {
        grid-template-columns: 1fr;
    }

    .dashboard-grid {
        grid-template-columns: 1fr;
    }
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1100;
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: var(--white);
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--light-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.modal-body {
    padding: 1.5rem;
}

.modal-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--light-color);
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
}

.close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--secondary-color);
}

/* Widget-specific Styles */

/* Common Widget Styles */
.widget-content {
    height: 100%;
    min-height: 300px;
    position: relative;
}

.widget-loader {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: var(--primary-color);
    z-index: 1;
}

.widget-error {
    text-align: center;
    padding: 2rem;
    color: var(--danger-color);
}

.widget-footer {
    padding: 1rem;
    border-top: 1px solid var(--light-color);
    text-align: center;
}

/* Recent Companies Widget */
.companies-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.company-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    background: var(--light-bg);
    border-radius: 8px;
    transition: all 0.3s ease;
}

.company-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.company-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.company-logo {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    font-size: 1.2rem;
}

.company-details {
    display: flex;
    flex-direction: column;
}

.company-details h4 {
    margin: 0;
    font-size: 1rem;
    color: var(--dark-color);
}

.company-details span {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.company-stats {
    display: flex;
    gap: 1.5rem;
}

.stat {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.stat-label {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.stat-value {
    font-weight: 600;
    color: var(--dark-color);
}

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 500;
}

.status-badge.active {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
}

.status-badge.pending {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning-color);
}

.company-actions {
    display: flex;
    gap: 0.5rem;
}

/* System Health Widget */
.system-health-metrics {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.health-metric {
    background: var(--light-bg);
    border-radius: 8px;
    padding: 1rem;
}

.metric-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.health-indicator {
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.875rem;
    font-weight: 500;
}

.health-indicator.good {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
}

.health-indicator.warning {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning-color);
}

.health-indicator.critical {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger-color);
}

.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

.metric-card {
    padding: 1rem;
    border-radius: 8px;
    background: white;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.metric-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.metric-info {
    flex: 1;
}

.metric-info h5 {
    margin: 0;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.metric-value {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--dark-color);
}

/* Revenue Analytics Widget */
.revenue-analytics {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.revenue-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.summary-card {
    background: var(--light-bg);
    border-radius: 8px;
    padding: 1.5rem;
}

.summary-card h4 {
    margin: 0 0 0.5rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.amount {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--dark-color);
    margin-bottom: 0.5rem;
}

.trend {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    border-radius: 999px;
    font-size: 0.875rem;
}

.trend.positive {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
}

.trend.negative {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger-color);
}

.revenue-chart {
    background: white;
    border-radius: 8px;
    padding: 1rem;
    height: 300px;
}

.revenue-breakdown {
    background: var(--light-bg);
    border-radius: 8px;
    padding: 1.5rem;
}

.plan-breakdown {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1rem;
}

.plan-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.plan-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.plan-info h5 {
    margin: 0;
    font-size: 0.875rem;
    color: var(--dark-color);
}

.plan-revenue {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.progress-bar {
    height: 6px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 999px;
    overflow: hidden;
}

.progress {
    height: 100%;
    border-radius: 999px;
    transition: width 0.3s ease;
}

/* Recent Activities Widget */
.activities-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.activity-item {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    background: var(--light-bg);
    border-radius: 8px;
}

.activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}

.activity-details {
    flex: 1;
}

.activity-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
}

.activity-header h5 {
    margin: 0;
    font-size: 0.875rem;
    color: var(--dark-color);
}

.activity-time {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.activity-metadata {
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.metadata-item {
    display: flex;
    gap: 0.5rem;
    font-size: 0.75rem;
}

.metadata-item .key {
    color: var(--text-secondary);
}

.metadata-item .value {
    color: var(--dark-color);
    font-weight: 500;
}

/* Support Tickets Widget */
.support-tickets {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.tickets-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.tickets-metrics {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.metric {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: white;
    border-radius: 8px;
}

.tickets-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.ticket-item {
    background: white;
    border-radius: 8px;
    padding: 1rem;
    border-left: 4px solid;
}

.ticket-item.high {
    border-color: var(--danger-color);
}

.ticket-item.medium {
    border-color: var(--warning-color);
}

.ticket-item.low {
    border-color: var(--success-color);
}

.ticket-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.ticket-id {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.ticket-priority {
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 500;
}

.ticket-content {
    margin-bottom: 1rem;
}

.ticket-content h5 {
    margin: 0 0 0.5rem;
    font-size: 0.875rem;
    color: var(--dark-color);
}

.ticket-content p {
    margin: 0;
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.ticket-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.ticket-company {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.ticket-company img {
    width: 24px;
    height: 24px;
    border-radius: 4px;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .company-stats {
        display: none;
    }

    .metrics-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .revenue-summary {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .metrics-grid {
        grid-template-columns: 1fr;
    }

    .activity-item {
        flex-direction: column;
    }

    .activity-icon {
        width: 32px;
        height: 32px;
    }
}
        
      </style>
</head>
<body>
     <!-- Sidebar -->
   <!-- Sidebar -->
<div class="sidebar">
    <div class="sidebar-header">
        <img src="logo.png" alt="Logo">
        <h2>WorkWise Pro</h2>
    </div>
    <ul class="nav-menu">
        <li class="nav-item">
            <a href="#" class="nav-link active">
                <i class="fas fa-home"></i>
                <span>Overview</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-building"></i>
                <span>Client Companies</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-cogs"></i>
                <span>System Settings</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-tags"></i>
                <span>Pricing & Plans</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-shield-alt"></i>
                <span>Security Settings</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-puzzle-piece"></i>
                <span>Module Management</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-users-cog"></i>
                <span>User Management</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-chart-bar"></i>
                <span>Analytics & Reports</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-database"></i>
                <span>Backup & Restore</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-history"></i>
                <span>Audit Logs</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-plug"></i>
                <span>API Management</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-life-ring"></i>
                <span>Support Center</span>
            </a>
        </li>
    </ul>
</div>

    
  <!-- Inside the main-content div, after the header -->
<!-- Main Content Area -->
<div class="main-content">
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <button id="sidebar-toggle" class="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="breadcrumb">
                <h2>Dashboard</h2>
            </div>
        </div>
        <div class="header-right">
            <div class="header-actions">
                <button class="btn btn-outline" id="customizeBtn">
                    <i class="fas fa-th-large"></i>
                    Customize Dashboard
                </button>
                <div class="notification-bell">
                    <i class="fas fa-bell"></i>
                    <span class="badge">3</span>
                </div>
                <div class="user-profile">
                    <img src="profile.png" alt="Admin">
                    <div class="user-info">
                        <span class="user-name">Super Admin</span>
                        <span class="user-role">System Administrator</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard-container">
        <!-- Quick Stats Section -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(79, 70, 229, 0.1);">
                    <i class="fas fa-building" style="color: #4F46E5;"></i>
                </div>
                <div class="stat-info">
                    <h3>Total Companies</h3>
                    <div class="stat-value">247</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>12% from last month</span>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1);">
                    <i class="fas fa-users" style="color: #10B981;"></i>
                </div>
                <div class="stat-info">
                    <h3>Active Users</h3>
                    <div class="stat-value">15,482</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>8.3% from last month</span>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1);">
                    <i class="fas fa-chart-line" style="color: #F59E0B;"></i>
                </div>
                <div class="stat-info">
                    <h3>Monthly Revenue</h3>
                    <div class="stat-value">$1.2M</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span>24% from last month</span>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(239, 68, 68, 0.1);">
                    <i class="fas fa-ticket-alt" style="color: #EF4444;"></i>
                </div>
                <div class="stat-info">
                    <h3>Support Tickets</h3>
                    <div class="stat-value">42</div>
                    <div class="stat-change negative">
                        <i class="fas fa-arrow-down"></i>
                        <span>5% from last month</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customizable Dashboard Grid -->
        <div class="dashboard-grid" id="dashboardGrid">
            <!-- Recent Companies Section -->
            <div class="dashboard-widget" data-widget="recent-companies">
                <div class="widget-header">
                    <h3>Recent Companies</h3>
                    <div class="widget-actions">
                        <button class="btn-icon" onclick="refreshWidget('recent-companies')">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="btn-icon" onclick="customizeWidget('recent-companies')">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <div class="company-list">
                        <!-- Company items will be dynamically loaded -->
                    </div>
                </div>
            </div>

            <!-- System Health Section -->
            <div class="dashboard-widget" data-widget="system-health">
                <div class="widget-header">
                    <h3>System Health</h3>
                    <div class="widget-actions">
                        <button class="btn-icon" onclick="refreshWidget('system-health')">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="btn-icon" onclick="customizeWidget('system-health')">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <!-- System health metrics will be dynamically loaded -->
                </div>
            </div>

            <!-- Revenue Analytics Section -->
            <div class="dashboard-widget" data-widget="revenue-analytics">
                <div class="widget-header">
                    <h3>Revenue Analytics</h3>
                    <div class="widget-actions">
                        <button class="btn-icon" onclick="refreshWidget('revenue-analytics')">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="btn-icon" onclick="customizeWidget('revenue-analytics')">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>

            <!-- Recent Activities Section -->
            <div class="dashboard-widget" data-widget="recent-activities">
                <div class="widget-header">
                    <h3>Recent Activities</h3>
                    <div class="widget-actions">
                        <button class="btn-icon" onclick="refreshWidget('recent-activities')">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button class="btn-icon" onclick="customizeWidget('recent-activities')">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                </div>
                <div class="widget-content">
                    <!-- Activities will be dynamically loaded -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Dashboard Customization Modal -->
<div class="modal" id="customizeDashboardModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Customize Dashboard</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="available-widgets">
                <!-- Widget options will be dynamically loaded -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeCustomizeModal()">Cancel</button>
            <button class="btn btn-primary" onclick="saveDashboardLayout()">Save Changes</button>
        </div>
    </div>
</div>
  
</body>
  // Add this before closing </body> tag
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

 <script>
     // Dashboard Management System
class DashboardManager {
    constructor() {
        this.widgets = new Map();
        this.layout = [];
        this.availableWidgets = {
            'recent-companies': {
                title: 'Recent Companies',
                icon: 'building',
                refreshInterval: 300000, // 5 minutes
                minHeight: 400
            },
            'system-health': {
                title: 'System Health',
                icon: 'heartbeat',
                refreshInterval: 60000, // 1 minute
                minHeight: 300
            },
            'revenue-analytics': {
                title: 'Revenue Analytics',
                icon: 'chart-line',
                refreshInterval: 900000, // 15 minutes
                minHeight: 400
            },
            'active-users': {
                title: 'Active Users',
                icon: 'users',
                refreshInterval: 60000,
                minHeight: 300
            },
            'recent-activities': {
                title: 'Recent Activities',
                icon: 'history',
                refreshInterval: 120000, // 2 minutes
                minHeight: 400
            },
            'support-tickets': {
                title: 'Support Tickets',
                icon: 'ticket-alt',
                refreshInterval: 300000,
                minHeight: 350
            }
        };
        this.initializeDashboard();
    }

    async initializeDashboard() {
        this.loadSavedLayout();
        this.initializeEventListeners();
        await this.renderDashboard();
        this.setupRefreshIntervals();
    }

    // Load saved dashboard layout from localStorage
    loadSavedLayout() {
        const savedLayout = localStorage.getItem('dashboardLayout');
        this.layout = savedLayout ? JSON.parse(savedLayout) : this.getDefaultLayout();
    }

    // Default dashboard layout
    getDefaultLayout() {
        return [
            'recent-companies',
            'system-health',
            'revenue-analytics',
            'recent-activities'
        ];
    }

    // Initialize event listeners
    initializeEventListeners() {
        // Customize dashboard button
        document.getElementById('customizeBtn').addEventListener('click', 
            () => this.openCustomizeModal());

        // Widget drag and drop
        const dashboardGrid = document.getElementById('dashboardGrid');
        new Sortable(dashboardGrid, {
            animation: 150,
            handle: '.widget-header',
            onEnd: () => this.saveCurrentLayout()
        });
    }

    // Render dashboard
    async renderDashboard() {
        const dashboardGrid = document.getElementById('dashboardGrid');
        dashboardGrid.innerHTML = '';

        for (const widgetId of this.layout) {
            if (this.availableWidgets[widgetId]) {
                const widget = await this.createWidget(widgetId);
                dashboardGrid.appendChild(widget);
            }
        }
    }

    // Create widget element
    async createWidget(widgetId) {
        const widgetConfig = this.availableWidgets[widgetId];
        const widget = document.createElement('div');
        widget.className = 'dashboard-widget';
        widget.dataset.widget = widgetId;
        widget.innerHTML = `
            <div class="widget-header">
                <h3>
                    <i class="fas fa-${widgetConfig.icon}"></i>
                    ${widgetConfig.title}
                </h3>
                <div class="widget-actions">
                    <button class="btn-icon refresh-widget" title="Refresh">
                        <i class="fas fa-sync"></i>
                    </button>
                    <button class="btn-icon customize-widget" title="Customize">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button class="btn-icon remove-widget" title="Remove">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="widget-content">
                <div class="widget-loader">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
            </div>
        `;

        // Add event listeners
        widget.querySelector('.refresh-widget').addEventListener('click', 
            () => this.refreshWidget(widgetId));
        widget.querySelector('.customize-widget').addEventListener('click', 
            () => this.customizeWidget(widgetId));
        widget.querySelector('.remove-widget').addEventListener('click', 
            () => this.removeWidget(widgetId));

        // Load widget content
        await this.loadWidgetContent(widget, widgetId);
        return widget;
    }

    // Load widget content
    async loadWidgetContent(widget, widgetId) {
        const contentDiv = widget.querySelector('.widget-content');
        try {
            const data = await this.fetchWidgetData(widgetId);
            contentDiv.innerHTML = await this.renderWidgetContent(widgetId, data);
        } catch (error) {
            contentDiv.innerHTML = `
                <div class="widget-error">
                    <i class="fas fa-exclamation-circle"></i>
                    <p>Error loading widget content</p>
                </div>
            `;
        }
    }

    // Fetch widget data
    async fetchWidgetData(widgetId) {
        // Implement API calls based on widget type
        switch (widgetId) {
            case 'recent-companies':
                return await this.fetchRecentCompanies();
            case 'system-health':
                return await this.fetchSystemHealth();
            case 'revenue-analytics':
                return await this.fetchRevenueAnalytics();
            // Add more cases for other widgets
        }
    }

    // Render widget content based on type
    async renderWidgetContent(widgetId, data) {
        switch (widgetId) {
            case 'recent-companies':
                return this.renderRecentCompanies(data);
            case 'system-health':
                return this.renderSystemHealth(data);
            case 'revenue-analytics':
                return this.renderRevenueAnalytics(data);
            // Add more cases for other widgets
        }
    }

    // Customize Modal
    openCustomizeModal() {
        const modal = document.createElement('div');
        modal.className = 'modal active';
        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Customize Dashboard</h2>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="available-widgets">
                        ${this.renderAvailableWidgets()}
                    </div>
                    <div class="layout-preview">
                        ${this.renderLayoutPreview()}
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-action="cancel">Cancel</button>
                    <button class="btn btn-primary" data-action="save">Save Changes</button>
                </div>
            </div>
        `;

        document.body.appendChild(modal);
        this.initializeModalEventListeners(modal);
    }

    // Render available widgets
    renderAvailableWidgets() {
        return Object.entries(this.availableWidgets)
            .map(([id, config]) => `
                <div class="widget-option" data-widget="${id}">
                    <i class="fas fa-${config.icon}"></i>
                    <span>${config.title}</span>
                    <button class="btn-icon add-widget">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            `).join('');
    }

    // Save dashboard layout
    saveCurrentLayout() {
        const widgets = Array.from(document.querySelectorAll('.dashboard-widget'))
            .map(widget => widget.dataset.widget);
        this.layout = widgets;
        localStorage.setItem('dashboardLayout', JSON.stringify(widgets));
    }

    // Refresh intervals
    setupRefreshIntervals() {
        for (const [widgetId, config] of Object.entries(this.availableWidgets)) {
            if (this.layout.includes(widgetId)) {
                setInterval(() => this.refreshWidget(widgetId), config.refreshInterval);
            }
        }
    }

    // Refresh widget
    async refreshWidget(widgetId) {
        const widget = document.querySelector(`[data-widget="${widgetId}"]`);
        if (widget) {
            const refreshButton = widget.querySelector('.refresh-widget i');
            refreshButton.classList.add('fa-spin');
            await this.loadWidgetContent(widget, widgetId);
            refreshButton.classList.remove('fa-spin');
        }
    }

    // Remove widget
    async removeWidget(widgetId) {
        const widget = document.querySelector(`[data-widget="${widgetId}"]`);
        if (widget) {
            widget.remove();
            this.saveCurrentLayout();
        }
    }
}

// Initialize Dashboard
const dashboardManager = new DashboardManager();

// Export for use in other modules
export { DashboardManager };

     // Widget Implementations
class DashboardWidgets {
    // Recent Companies Widget
    static async renderRecentCompanies(data) {
        return `
            <div class="companies-list">
                ${data.companies.map(company => `
                    <div class="company-item">
                        <div class="company-info">
                            <div class="company-logo" style="background-color: ${this.getRandomColor()}">
                                ${this.getCompanyInitials(company.name)}
                            </div>
                            <div class="company-details">
                                <h4>${company.name}</h4>
                                <span>${company.industry}</span>
                            </div>
                        </div>
                        <div class="company-stats">
                            <div class="stat">
                                <span class="stat-label">Employees</span>
                                <span class="stat-value">${company.employeeCount}</span>
                            </div>
                            <div class="stat">
                                <span class="stat-label">Status</span>
                                <span class="status-badge ${company.status.toLowerCase()}">
                                    ${company.status}
                                </span>
                            </div>
                        </div>
                        <div class="company-actions">
                            <button class="btn-icon" onclick="viewCompany('${company.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" onclick="editCompany('${company.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                `).join('')}
            </div>
            <div class="widget-footer">
                <button class="btn btn-link" onclick="viewAllCompanies()">
                    View All Companies <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        `;
    }

    // System Health Widget
    static async renderSystemHealth(data) {
        const getHealthStatus = (value, threshold) => {
            if (value >= threshold.good) return 'good';
            if (value >= threshold.warning) return 'warning';
            return 'critical';
        };

        return `
            <div class="system-health-metrics">
                <div class="health-metric">
                    <div class="metric-header">
                        <h4>System Performance</h4>
                        <span class="health-indicator ${getHealthStatus(data.performance, {good: 90, warning: 70})}">
                            ${data.performance}%
                        </span>
                    </div>
                    <div class="metric-chart">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card ${getHealthStatus(data.cpu.usage, {good: 70, warning: 85})}">
                        <div class="metric-icon">
                            <i class="fas fa-microchip"></i>
                        </div>
                        <div class="metric-info">
                            <h5>CPU Usage</h5>
                            <span class="metric-value">${data.cpu.usage}%</span>
                        </div>
                    </div>

                    <div class="metric-card ${getHealthStatus(data.memory.usage, {good: 70, warning: 85})}">
                        <div class="metric-icon">
                            <i class="fas fa-memory"></i>
                        </div>
                        <div class="metric-info">
                            <h5>Memory Usage</h5>
                            <span class="metric-value">${data.memory.usage}%</span>
                        </div>
                    </div>

                    <div class="metric-card ${getHealthStatus(data.storage.usage, {good: 70, warning: 85})}">
                        <div class="metric-icon">
                            <i class="fas fa-hdd"></i>
                        </div>
                        <div class="metric-info">
                            <h5>Storage Usage</h5>
                            <span class="metric-value">${data.storage.usage}%</span>
                        </div>
                    </div>

                    <div class="metric-card ${data.network.status}">
                        <div class="metric-icon">
                            <i class="fas fa-network-wired"></i>
                        </div>
                        <div class="metric-info">
                            <h5>Network Status</h5>
                            <span class="metric-value">${data.network.latency}ms</span>
                        </div>
                    </div>
                </div>

                <div class="active-issues">
                    <h4>Active Issues (${data.issues.length})</h4>
                    <div class="issues-list">
                        ${data.issues.map(issue => `
                            <div class="issue-item ${issue.severity}">
                                <div class="issue-icon">
                                    <i class="fas fa-exclamation-${issue.severity === 'critical' ? 'circle' : 'triangle'}"></i>
                                </div>
                                <div class="issue-details">
                                    <h5>${issue.title}</h5>
                                    <span>${issue.description}</span>
                                </div>
                                <div class="issue-time">
                                    ${this.formatTimeAgo(issue.timestamp)}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    }

    // Revenue Analytics Widget
    static async renderRevenueAnalytics(data) {
        return `
            <div class="revenue-analytics">
                <div class="revenue-summary">
                    <div class="summary-card">
                        <h4>Total Revenue</h4>
                        <div class="amount">$${this.formatNumber(data.totalRevenue)}</div>
                        <div class="trend ${data.revenueGrowth >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-arrow-${data.revenueGrowth >= 0 ? 'up' : 'down'}"></i>
                            ${Math.abs(data.revenueGrowth)}%
                        </div>
                    </div>
                    <div class="summary-card">
                        <h4>Active Subscriptions</h4>
                        <div class="amount">${this.formatNumber(data.activeSubscriptions)}</div>
                        <div class="trend ${data.subscriptionGrowth >= 0 ? 'positive' : 'negative'}">
                            <i class="fas fa-arrow-${data.subscriptionGrowth >= 0 ? 'up' : 'down'}"></i>
                            ${Math.abs(data.subscriptionGrowth)}%
                        </div>
                    </div>
                </div>

                <div class="revenue-chart">
                    <canvas id="revenueChart"></canvas>
                </div>

                <div class="revenue-breakdown">
                    <h4>Revenue by Plan</h4>
                    <div class="plan-breakdown">
                        ${data.revenuePlans.map(plan => `
                            <div class="plan-item">
                                <div class="plan-info">
                                    <h5>${plan.name}</h5>
                                    <span>${plan.subscribers} subscribers</span>
                                </div>
                                <div class="plan-revenue">
                                    <div class="amount">$${this.formatNumber(plan.revenue)}</div>
                                    <div class="percentage">${plan.percentage}%</div>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress" style="width: ${plan.percentage}%; background-color: ${plan.color}"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    }

    // Recent Activities Widget
    static async renderRecentActivities(data) {
        return `
            <div class="activities-list">
                ${data.activities.map(activity => `
                    <div class="activity-item">
                        <div class="activity-icon" style="background-color: ${this.getActivityColor(activity.type)}">
                            <i class="fas ${this.getActivityIcon(activity.type)}"></i>
                        </div>
                        <div class="activity-details">
                            <div class="activity-header">
                                <h5>${activity.title}</h5>
                                <span class="activity-time">${this.formatTimeAgo(activity.timestamp)}</span>
                            </div>
                            <p>${activity.description}</p>
                            ${activity.metadata ? `
                                <div class="activity-metadata">
                                    ${this.renderActivityMetadata(activity.metadata)}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('')}
            </div>
            <div class="widget-footer">
                <button class="btn btn-link" onclick="viewAllActivities()">
                    View All Activities <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        `;
    }

    // Support Tickets Widget
    static async renderSupportTickets(data) {
        return `
            <div class="support-tickets">
                <div class="tickets-summary">
                    <div class="summary-card">
                        <h4>Open Tickets</h4>
                        <div class="amount">${data.openTickets}</div>
                        <div class="trend">
                            ${this.renderTicketTrend(data.ticketTrend)}
                        </div>
                    </div>
                    <div class="tickets-metrics">
                        <div class="metric">
                            <span class="label">Average Response Time</span>
                            <span class="value">${data.avgResponseTime}</span>
                        </div>
                        <div class="metric">
                            <span class="label">Resolution Rate</span>
                            <span class="value">${data.resolutionRate}%</span>
                        </div>
                    </div>
                </div>

                <div class="tickets-list">
                    ${data.recentTickets.map(ticket => `
                        <div class="ticket-item ${ticket.priority}">
                            <div class="ticket-header">
                                <div class="ticket-id">#${ticket.id}</div>
                                <div class="ticket-priority">${ticket.priority}</div>
                            </div>
                            <div class="ticket-content">
                                <h5>${ticket.subject}</h5>
                                <p>${ticket.description}</p>
                            </div>
                            <div class="ticket-footer">
                                <div class="ticket-company">
                                    <img src="${ticket.company.logo}" alt="${ticket.company.name}">
                                    <span>${ticket.company.name}</span>
                                </div>
                                <div class="ticket-time">
                                    ${this.formatTimeAgo(ticket.createdAt)}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    // Utility Methods
    static formatNumber(number) {
        return new Intl.NumberFormat().format(number);
    }

    static formatTimeAgo(timestamp) {
        const now = new Date();
        const time = new Date(timestamp);
        const diff = Math.floor((now - time) / 1000);

        if (diff < 60) return 'just now';
        if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
        if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
        return `${Math.floor(diff / 86400)}d ago`;
    }

    static getRandomColor() {
        const colors = ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    static getCompanyInitials(name) {
        return name
            .split(' ')
            .map(word => word[0])
            .join('')
            .substring(0, 2)
            .toUpperCase();
    }

    static getActivityIcon(type) {
        const icons = {
            'user': 'fa-user',
            'company': 'fa-building',
            'subscription': 'fa-credit-card',
            'system': 'fa-cog',
            'security': 'fa-shield-alt'
        };
        return icons[type] || 'fa-info-circle';
    }

    static getActivityColor(type) {
        const colors = {
            'user': '#4F46E5',
            'company': '#10B981',
            'subscription': '#F59E0B',
            'system': '#6B7280',
            'security': '#EF4444'
        };
        return colors[type] || '#6B7280';
    }

    static renderActivityMetadata(metadata) {
        return Object.entries(metadata)
            .map(([key, value]) => `
                <div class="metadata-item">
                    <span class="key">${key}:</span>
                    <span class="value">${value}</span>
                </div>
            `).join('');
    }

    static renderTicketTrend(trend) {
        const isPositive = trend >= 0;
        return `
            <div class="trend ${isPositive ? 'positive' : 'negative'}">
                <i class="fas fa-arrow-${isPositive ? 'up' : 'down'}"></i>
                ${Math.abs(trend)}%
            </div>
        `;
    }
}

// Export for use in dashboard manager
export { DashboardWidgets };

// API Service for Widget Data
class WidgetDataService {
    constructor() {
        this.baseUrl = 'https://your-api-endpoint.com/api';
        this.token = localStorage.getItem('token');
    }

    // Common headers for API requests
    get headers() {
        return {
            'Authorization': `Bearer ${this.token}`,
            'Content-Type': 'application/json'
        };
    }

    // Generic API call method
    async fetchData(endpoint, options = {}) {
        try {
            const response = await fetch(`${this.baseUrl}${endpoint}`, {
                ...options,
                headers: this.headers
            });

            if (!response.ok) {
                throw new Error(`API Error: ${response.statusText}`);
            }

            return await response.json();
        } catch (error) {
            console.error('API Request Failed:', error);
            throw error;
        }
    }

    // Recent Companies Data
    async fetchRecentCompanies() {
        return this.fetchData('/companies/recent', {
            method: 'GET',
            params: {
                limit: 5,
                sort: 'createdAt',
                order: 'desc'
            }
        });
    }

    // System Health Data
    async fetchSystemHealth() {
        const [performance, resources, issues] = await Promise.all([
            this.fetchData('/system/performance'),
            this.fetchData('/system/resources'),
            this.fetchData('/system/issues')
        ]);

        return {
            performance,
            resources,
            issues
        };
    }

    // Revenue Analytics Data
    async fetchRevenueAnalytics(timeframe = 'month') {
        return this.fetchData('/analytics/revenue', {
            method: 'GET',
            params: {
                timeframe,
                includeBreakdown: true
            }
        });
    }

    // Recent Activities Data
    async fetchRecentActivities() {
        return this.fetchData('/activities/recent', {
            method: 'GET',
            params: {
                limit: 10,
                includeMetadata: true
            }
        });
    }

    // Support Tickets Data
    async fetchSupportTickets() {
        return this.fetchData('/support/tickets', {
            method: 'GET',
            params: {
                status: 'open',
                sort: 'priority'
            }
        });
    }
}

// Widget Data Handlers
class WidgetDataHandler {
    constructor() {
        this.dataService = new WidgetDataService();
        this.cache = new Map();
        this.cacheTimeout = 5 * 60 * 1000; // 5 minutes
    }

    // Cache management
    isCacheValid(key) {
        const cached = this.cache.get(key);
        if (!cached) return false;
        return (Date.now() - cached.timestamp) < this.cacheTimeout;
    }

    setCacheData(key, data) {
        this.cache.set(key, {
            data,
            timestamp: Date.now()
        });
    }

    // Recent Companies Handler
    async getRecentCompanies() {
        const cacheKey = 'recent-companies';
        
        if (this.isCacheValid(cacheKey)) {
            return this.cache.get(cacheKey).data;
        }

        try {
            const data = await this.dataService.fetchRecentCompanies();
            this.setCacheData(cacheKey, data);
            return data;
        } catch (error) {
            console.error('Failed to fetch recent companies:', error);
            throw error;
        }
    }

    // System Health Handler
    async getSystemHealth() {
        const cacheKey = 'system-health';
        
        // Short cache timeout for system health
        const healthCacheTimeout = 60 * 1000; // 1 minute

        if (this.cache.has(cacheKey) && 
            (Date.now() - this.cache.get(cacheKey).timestamp) < healthCacheTimeout) {
            return this.cache.get(cacheKey).data;
        }

        try {
            const data = await this.dataService.fetchSystemHealth();
            this.setCacheData(cacheKey, data);
            return data;
        } catch (error) {
            console.error('Failed to fetch system health:', error);
            throw error;
        }
    }

    // Revenue Analytics Handler
    async getRevenueAnalytics(timeframe) {
        const cacheKey = `revenue-analytics-${timeframe}`;
        
        if (this.isCacheValid(cacheKey)) {
            return this.cache.get(cacheKey).data;
        }

        try {
            const data = await this.dataService.fetchRevenueAnalytics(timeframe);
            this.setCacheData(cacheKey, data);
            return data;
        } catch (error) {
            console.error('Failed to fetch revenue analytics:', error);
            throw error;
        }
    }

    // Recent Activities Handler
    async getRecentActivities() {
        const cacheKey = 'recent-activities';
        
        if (this.isCacheValid(cacheKey)) {
            return this.cache.get(cacheKey).data;
        }

        try {
            const data = await this.dataService.fetchRecentActivities();
            this.setCacheData(cacheKey, data);
            return data;
        } catch (error) {
            console.error('Failed to fetch recent activities:', error);
            throw error;
        }
    }

    // Support Tickets Handler
    async getSupportTickets() {
        const cacheKey = 'support-tickets';
        
        if (this.isCacheValid(cacheKey)) {
            return this.cache.get(cacheKey).data;
        }

        try {
            const data = await this.dataService.fetchSupportTickets();
            this.setCacheData(cacheKey, data);
            return data;
        } catch (error) {
            console.error('Failed to fetch support tickets:', error);
            throw error;
        }
    }
}

// Real-time Updates Handler
class RealTimeUpdatesHandler {
    constructor() {
        this.socket = null;
        this.subscribers = new Map();
        this.reconnectAttempts = 0;
        this.maxReconnectAttempts = 5;
        this.reconnectDelay = 5000; // 5 seconds
    }

    // Initialize WebSocket connection
    initializeSocket() {
        this.socket = new WebSocket('wss://your-websocket-endpoint.com');

        this.socket.onopen = () => {
            console.log('WebSocket connected');
            this.reconnectAttempts = 0;
        };

        this.socket.onmessage = (event) => {
            const update = JSON.parse(event.data);
            this.handleUpdate(update);
        };

        this.socket.onclose = () => {
            console.log('WebSocket disconnected');
            this.attemptReconnect();
        };

        this.socket.onerror = (error) => {
            console.error('WebSocket error:', error);
        };
    }

    // Handle reconnection
    attemptReconnect() {
        if (this.reconnectAttempts < this.maxReconnectAttempts) {
            setTimeout(() => {
                this.reconnectAttempts++;
                this.initializeSocket();
            }, this.reconnectDelay);
        }
    }

    // Subscribe to updates
    subscribe(widgetId, callback) {
        if (!this.subscribers.has(widgetId)) {
            this.subscribers.set(widgetId, new Set());
        }
        this.subscribers.get(widgetId).add(callback);
    }

    // Unsubscribe from updates
    unsubscribe(widgetId, callback) {
        if (this.subscribers.has(widgetId)) {
            this.subscribers.get(widgetId).delete(callback);
        }
    }

    // Handle incoming updates
    handleUpdate(update) {
        const { type, data } = update;
        
        if (this.subscribers.has(type)) {
            this.subscribers.get(type).forEach(callback => {
                callback(data);
            });
        }
    }

    // Send message to server
    sendMessage(type, data) {
        if (this.socket && this.socket.readyState === WebSocket.OPEN) {
            this.socket.send(JSON.stringify({ type, data }));
        }
    }
}

// Widget Data Manager
class WidgetDataManager {
    constructor() {
        this.dataHandler = new WidgetDataHandler();
        this.realTimeHandler = new RealTimeUpdatesHandler();
        this.initializeRealTimeUpdates();
    }

    // Initialize real-time updates
    initializeRealTimeUpdates() {
        this.realTimeHandler.initializeSocket();
    }

    // Get widget data
    async getWidgetData(widgetId, params = {}) {
        switch (widgetId) {
            case 'recent-companies':
                return this.dataHandler.getRecentCompanies();
            case 'system-health':
                return this.dataHandler.getSystemHealth();
            case 'revenue-analytics':
                return this.dataHandler.getRevenueAnalytics(params.timeframe);
            case 'recent-activities':
                return this.dataHandler.getRecentActivities();
            case 'support-tickets':
                return this.dataHandler.getSupportTickets();
            default:
                throw new Error(`Unknown widget type: ${widgetId}`);
        }
    }

    // Subscribe to real-time updates
    subscribeToUpdates(widgetId, callback) {
        this.realTimeHandler.subscribe(widgetId, callback);
    }

    // Unsubscribe from real-time updates
    unsubscribeFromUpdates(widgetId, callback) {
        this.realTimeHandler.unsubscribe(widgetId, callback);
    }
}

// Export the Widget Data Manager
export const widgetDataManager = new WidgetDataManager();     

 // Chart Configurations and Implementations
class ChartManager {
    constructor() {
        this.charts = new Map();
        this.defaultOptions = {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 1000,
                easing: 'easeInOutQuart'
            }
        };
    }

    // Revenue Chart Configuration
    createRevenueChart(containerId, data) {
        const ctx = document.getElementById(containerId).getContext('2d');
        const gradientFill = ctx.createLinearGradient(0, 0, 0, 400);
        gradientFill.addColorStop(0, 'rgba(79, 70, 229, 0.2)');
        gradientFill.addColorStop(1, 'rgba(79, 70, 229, 0)');

        const config = {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Revenue',
                    data: data.values,
                    borderColor: '#4F46E5',
                    borderWidth: 2,
                    backgroundColor: gradientFill,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointBackgroundColor: '#4F46E5',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointHoverRadius: 6,
                    pointHoverBackgroundColor: '#4F46E5',
                    pointHoverBorderColor: '#fff',
                    pointHoverBorderWidth: 2
                }]
            },
            options: {
                ...this.defaultOptions,
                scales: {
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            callback: (value) => `$${this.formatNumber(value)}`,
                            font: {
                                size: 12
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleFont: {
                            size: 13
                        },
                        bodyFont: {
                            size: 12
                        },
                        padding: 12,
                        callbacks: {
                            label: (context) => `Revenue: $${this.formatNumber(context.raw)}`
                        }
                    }
                }
            }
        };

        return new Chart(ctx, config);
    }

    // System Health Chart Configuration
    createSystemHealthChart(containerId, data) {
        const ctx = document.getElementById(containerId).getContext('2d');

        const config = {
            type: 'doughnut',
            data: {
                labels: ['CPU', 'Memory', 'Storage', 'Network'],
                datasets: [{
                    data: [
                        data.cpu.usage,
                        data.memory.usage,
                        data.storage.usage,
                        data.network.usage
                    ],
                    backgroundColor: [
                        '#4F46E5',
                        '#10B981',
                        '#F59E0B',
                        '#3B82F6'
                    ],
                    borderWidth: 0,
                    borderRadius: 4
                }]
            },
            options: {
                ...this.defaultOptions,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: (context) => `${context.label}: ${context.raw}%`
                        }
                    }
                }
            }
        };

        return new Chart(ctx, config);
    }

    // User Activity Chart Configuration
    createActivityChart(containerId, data) {
        const ctx = document.getElementById(containerId).getContext('2d');

        const config = {
            type: 'bar',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Active Users',
                    data: data.values,
                    backgroundColor: '#4F46E5',
                    borderRadius: 4,
                    barThickness: 12
                }]
            },
            options: {
                ...this.defaultOptions,
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        };

        return new Chart(ctx, config);
    }

    // Subscription Trend Chart Configuration
    createSubscriptionTrendChart(containerId, data) {
        const ctx = document.getElementById(containerId).getContext('2d');

        const config = {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: data.plans.map((plan, index) => ({
                    label: plan.name,
                    data: plan.values,
                    borderColor: this.getChartColor(index),
                    backgroundColor: this.getChartColor(index, 0.1),
                    fill: true,
                    tension: 0.4,
                    pointRadius: 3,
                    pointBackgroundColor: this.getChartColor(index)
                }))
            },
            options: {
                ...this.defaultOptions,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            callback: (value) => this.formatNumber(value)
                        }
                    }
                }
            }
        };

        return new Chart(ctx, config);
    }

    // Performance Metrics Chart Configuration
    createPerformanceChart(containerId, data) {
        const ctx = document.getElementById(containerId).getContext('2d');

        const config = {
            type: 'radar',
            data: {
                labels: ['Response Time', 'Throughput', 'Error Rate', 'CPU Usage', 'Memory Usage'],
                datasets: [{
                    label: 'Current',
                    data: data.current,
                    borderColor: '#4F46E5',
                    backgroundColor: 'rgba(79, 70, 229, 0.2)',
                    pointBackgroundColor: '#4F46E5',
                    pointBorderColor: '#fff'
                }, {
                    label: 'Previous',
                    data: data.previous,
                    borderColor: '#10B981',
                    backgroundColor: 'rgba(16, 185, 129, 0.2)',
                    pointBackgroundColor: '#10B981',
                    pointBorderColor: '#fff'
                }]
            },
            options: {
                ...this.defaultOptions,
                scales: {
                    r: {
                        beginAtZero: true,
                        ticks: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        };

        return new Chart(ctx, config);
    }

    // Utility Methods
    formatNumber(number) {
        return new Intl.NumberFormat().format(number);
    }

    getChartColor(index, alpha = 1) {
        const colors = [
            `rgba(79, 70, 229, ${alpha})`,    // Primary
            `rgba(16, 185, 129, ${alpha})`,   // Success
            `rgba(245, 158, 11, ${alpha})`,   // Warning
            `rgba(59, 130, 246, ${alpha})`,   // Info
            `rgba(239, 68, 68, ${alpha})`     // Danger
        ];
        return colors[index % colors.length];
    }

    // Chart Update Methods
    updateChart(chartId, newData) {
        const chart = this.charts.get(chartId);
        if (chart) {
            chart.data = newData;
            chart.update('active');
        }
    }

    // Chart Destruction
    destroyChart(chartId) {
        const chart = this.charts.get(chartId);
        if (chart) {
            chart.destroy();
            this.charts.delete(chartId);
        }
    }

    // Chart Resize Handler
    handleResize() {
        this.charts.forEach(chart => {
            chart.resize();
        });
    }
}

// Chart Animation Utilities
const chartAnimations = {
    easeInOutQuart: (t) => {
        return t < 0.5 
            ? 8 * t * t * t * t 
            : 1 - 8 * (--t) * t * t * t;
    },
    
    bounceIn: (t) => {
        return 1 - Math.pow(1 - t, 3);
    }
};

// Initialize Chart Manager
const chartManager = new ChartManager();

// Add window resize listener
window.addEventListener('resize', () => {
    chartManager.handleResize();
});

// Export Chart Manager
export { chartManager };    

     // Advanced Chart Types and Customizations
class AdvancedChartManager extends ChartManager {
    constructor() {
        super();
        this.customThemes = new Map();
        this.initializeCustomThemes();
    }

    // Custom Themes Configuration
    initializeCustomThemes() {
        this.customThemes.set('light', {
            backgroundColor: '#ffffff',
            textColor: '#1F2937',
            gridColor: 'rgba(0, 0, 0, 0.05)',
            tooltipBackground: 'rgba(0, 0, 0, 0.8)',
            colors: [
                '#4F46E5', '#10B981', '#F59E0B', 
                '#3B82F6', '#EF4444', '#8B5CF6'
            ]
        });

        this.customThemes.set('dark', {
            backgroundColor: '#1F2937',
            textColor: '#F9FAFB',
            gridColor: 'rgba(255, 255, 255, 0.1)',
            tooltipBackground: 'rgba(0, 0, 0, 0.9)',
            colors: [
                '#818CF8', '#34D399', '#FBBF24', 
                '#60A5FA', '#F87171', '#A78BFA'
            ]
        });
    }

    // Stacked Area Chart
    createStackedAreaChart(containerId, data, options = {}) {
        const ctx = document.getElementById(containerId).getContext('2d');
        const theme = this.customThemes.get(options.theme || 'light');

        const config = {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: data.datasets.map((dataset, index) => ({
                    label: dataset.label,
                    data: dataset.data,
                    backgroundColor: theme.colors[index],
                    borderColor: theme.colors[index],
                    fill: true,
                    tension: 0.4
                }))
            },
            options: {
                ...this.defaultOptions,
                scales: {
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: theme.textColor
                        }
                    },
                    y: {
                        stacked: true,
                        grid: {
                            color: theme.gridColor
                        },
                        ticks: {
                            color: theme.textColor
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        backgroundColor: theme.tooltipBackground,
                        mode: 'index'
                    }
                }
            }
        };

        return new Chart(ctx, config);
    }

    // Bubble Chart for Resource Usage
    createResourceBubbleChart(containerId, data, options = {}) {
        const ctx = document.getElementById(containerId).getContext('2d');
        const theme = this.customThemes.get(options.theme || 'light');

        const config = {
            type: 'bubble',
            data: {
                datasets: data.map((dataset, index) => ({
                    label: dataset.label,
                    data: dataset.data.map(item => ({
                        x: item.usage,
                        y: item.performance,
                        r: item.importance * 5
                    })),
                    backgroundColor: `${theme.colors[index]}80`,
                    borderColor: theme.colors[index]
                }))
            },
            options: {
                ...this.defaultOptions,
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Resource Usage (%)',
                            color: theme.textColor
                        },
                        grid: {
                            color: theme.gridColor
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Performance Score',
                            color: theme.textColor
                        },
                        grid: {
                            color: theme.gridColor
                        }
                    }
                }
            }
        };

        return new Chart(ctx, config);
    }

    // Polar Area Chart for Department Distribution
    createDepartmentDistributionChart(containerId, data, options = {}) {
        const ctx = document.getElementById(containerId).getContext('2d');
        const theme = this.customThemes.get(options.theme || 'light');

        const config = {
            type: 'polarArea',
            data: {
                labels: data.labels,
                datasets: [{
                    data: data.values,
                    backgroundColor: theme.colors.map(color => `${color}80`),
                    borderColor: theme.colors
                }]
            },
            options: {
                ...this.defaultOptions,
                scales: {
                    r: {
                        ticks: {
                            color: theme.textColor
                        },
                        grid: {
                            color: theme.gridColor
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: theme.textColor
                        }
                    }
                }
            }
        };

        return new Chart(ctx, config);
    }

    // Gauge Chart for System Health
    createGaugeChart(containerId, value, options = {}) {
        const ctx = document.getElementById(containerId).getContext('2d');
        const theme = this.customThemes.get(options.theme || 'light');

        const config = {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [value, 100 - value],
                    backgroundColor: [
                        this.getHealthColor(value),
                        theme.gridColor
                    ],
                    circumference: 180,
                    rotation: 270
                }]
            },
            options: {
                ...this.defaultOptions,
                cutout: '80%',
                plugins: {
                    tooltip: {
                        enabled: false
                    },
                    legend: {
                        display: false
                    }
                }
            },
            plugins: [{
                id: 'gaugeLabel',
                afterDraw: (chart) => {
                    const { width, height } = chart;
                    const ctx = chart.ctx;
                    ctx.save();
                    ctx.fillStyle = theme.textColor;
                    ctx.font = 'bold 24px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillText(
                        `${value}%`,
                        width / 2,
                        height * 0.8
                    );
                    ctx.restore();
                }
            }]
        };

        return new Chart(ctx, config);
    }

    // Multi-Axis Chart for Metrics Comparison
    createMultiAxisChart(containerId, data, options = {}) {
        const ctx = document.getElementById(containerId).getContext('2d');
        const theme = this.customThemes.get(options.theme || 'light');

        const config = {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: data.datasets.map((dataset, index) => ({
                    label: dataset.label,
                    data: dataset.data,
                    borderColor: theme.colors[index],
                    backgroundColor: `${theme.colors[index]}20`,
                    yAxisID: dataset.axis,
                    tension: 0.4,
                    fill: true
                }))
            },
            options: {
                ...this.defaultOptions,
                scales: {
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: theme.textColor
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'left',
                        grid: {
                            color: theme.gridColor
                        },
                        ticks: {
                            color: theme.textColor
                        }
                    },
                    y2: {
                        type: 'linear',
                        position: 'right',
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: theme.textColor
                        }
                    }
                }
            }
        };

        return new Chart(ctx, config);
    }

    // Tree Map Chart for Resource Allocation
    createTreeMapChart(containerId, data, options = {}) {
        const ctx = document.getElementById(containerId).getContext('2d');
        const theme = this.customThemes.get(options.theme || 'light');

        // Custom implementation for treemap layout
        const treemapLayout = this.calculateTreemapLayout(data, {
            width: ctx.canvas.width,
            height: ctx.canvas.height
        });

        // Render treemap
        this.renderTreemap(ctx, treemapLayout, theme);
    }

    // Utility Methods
    getHealthColor(value) {
        if (value >= 80) return '#10B981'; // Good
        if (value >= 60) return '#F59E0B'; // Warning
        return '#EF4444'; // Critical
    }

    calculateTreemapLayout(data, dimensions) {
        // Implementation of squarified treemap algorithm
        // Returns layout information for rendering
    }

    renderTreemap(ctx, layout, theme) {
        // Custom rendering of treemap using canvas API
    }

    // Interactive Features
    addChartInteractivity(chart, callbacks) {
        chart.options.onClick = callbacks.onClick;
        chart.options.onHover = callbacks.onHover;
        
        if (callbacks.onLegendClick) {
            chart.options.plugins.legend.onClick = callbacks.onLegendClick;
        }

        chart.update();
    }

    // Animation Effects
    addCustomAnimation(chart, type) {
        const animations = {
            fadeIn: {
                duration: 1000,
                easing: 'easeOutQuart',
                from: 0,
                to: 1
            },
            growUp: {
                duration: 1500,
                easing: 'easeInOutQuart',
                from: 0,
                to: 1,
                loop: false
            }
        };

        chart.options.animation = animations[type];
        chart.update();
    }
}

// Initialize Advanced Chart Manager
const advancedChartManager = new AdvancedChartManager();

// Export Advanced Chart Manager
export { advancedChartManager };

     // Interactive Chart Features and Event Handler System
class ChartInteractionManager {
    constructor() {
        this.eventHandlers = new Map();
        this.tooltipCallbacks = new Map();
        this.customInteractions = new Map();
        this.initializeInteractions();
    }

    // Initialize Default Interactions
    initializeInteractions() {
        // Custom Tooltip Template
        Chart.defaults.plugins.tooltip = {
            ...Chart.defaults.plugins.tooltip,
            backgroundColor: 'rgba(17, 24, 39, 0.95)',
            titleColor: '#fff',
            bodyColor: '#fff',
            borderColor: 'rgba(255, 255, 255, 0.1)',
            borderWidth: 1,
            padding: 12,
            cornerRadius: 8,
            titleFont: {
                size: 14,
                weight: '600',
                family: 'Inter'
            },
            bodyFont: {
                size: 13,
                family: 'Inter'
            },
            displayColors: true,
            boxWidth: 8,
            boxHeight: 8,
            boxPadding: 4,
            usePointStyle: true
        };
    }

    // Add Interactive Features to Chart
    addInteractivity(chart, options = {}) {
        const {
            onClick,
            onHover,
            onLeave,
            tooltipCallbacks,
            zoomEnabled,
            panEnabled,
            drilldownEnabled
        } = options;

        // Click Handler
        if (onClick) {
            chart.options.onClick = (event, elements) => {
                const points = chart.getElementsAtEventForMode(
                    event, 
                    'nearest', 
                    { intersect: true },
                    true
                );
                if (points.length) {
                    onClick(this.getClickData(chart, points[0]));
                }
            };
        }

        // Hover Handler
        if (onHover || onLeave) {
            chart.options.onHover = (event, elements) => {
                const point = elements[0];
                if (point && onHover) {
                    onHover(this.getHoverData(chart, point));
                } else if (!point && onLeave) {
                    onLeave();
                }
                // Update cursor style
                event.native.target.style.cursor = point ? 'pointer' : 'default';
            };
        }

        // Custom Tooltip
        if (tooltipCallbacks) {
            chart.options.plugins.tooltip.callbacks = {
                ...chart.options.plugins.tooltip.callbacks,
                ...tooltipCallbacks
            };
        }

        // Enable Zoom (if requested)
        if (zoomEnabled) {
            this.enableZoom(chart);
        }

        // Enable Pan (if requested)
        if (panEnabled) {
            this.enablePan(chart);
        }

        // Enable Drilldown (if requested)
        if (drilldownEnabled) {
            this.enableDrilldown(chart);
        }

        chart.update();
    }

    // Enable Zoom Functionality
    enableZoom(chart) {
        chart.options.plugins.zoom = {
            zoom: {
                wheel: {
                    enabled: true,
                    modifierKey: 'ctrl'
                },
                pinch: {
                    enabled: true
                },
                mode: 'xy',
                onZoom: (context) => {
                    this.handleZoomEvent(chart, context);
                }
            },
            limits: {
                x: { min: 'original', max: 'original' },
                y: { min: 'original', max: 'original' }
            }
        };
    }

    // Enable Pan Functionality
    enablePan(chart) {
        chart.options.plugins.zoom.pan = {
            enabled: true,
            mode: 'xy',
            threshold: 10,
            onPan: (context) => {
                this.handlePanEvent(chart, context);
            }
        };
    }

    // Enable Drilldown Functionality
    enableDrilldown(chart) {
        this.customInteractions.set(chart.id, {
            drilldownStack: [],
            currentLevel: 0
        });

        chart.options.onClick = (event, elements) => {
            if (elements.length > 0) {
                const element = elements[0];
                this.handleDrilldown(chart, element);
            }
        };
    }

    // Custom Context Menu
    addContextMenu(chart, menuItems) {
        const canvas = chart.canvas;
        
        canvas.addEventListener('contextmenu', (event) => {
            event.preventDefault();
            
            const points = chart.getElementsAtEventForMode(
                event, 
                'nearest', 
                { intersect: true },
                true
            );

            if (points.length) {
                this.showContextMenu(event, points[0], menuItems);
            }
        });
    }

    // Interactive Legend
    enableInteractiveLegend(chart) {
        chart.options.plugins.legend.onClick = (event, legendItem, legend) => {
            const index = legendItem.datasetIndex;
            const type = chart.config.type;

            // Toggle dataset visibility
            const meta = chart.getDatasetMeta(index);
            meta.hidden = meta.hidden === null ? !chart.data.datasets[index].hidden : null;

            // Special handling for pie/doughnut charts
            if (type === 'pie' || type === 'doughnut') {
                this.handlePieChartLegendClick(chart, legendItem);
            }

            chart.update();
        };

        chart.options.plugins.legend.onHover = (event, legendItem, legend) => {
            const index = legendItem.datasetIndex;
            this.highlightDataset(chart, index);
        };
    }

    // Data Point Highlighting
    enableDataPointHighlight(chart) {
        chart.options.onHover = (event, elements) => {
            if (elements.length) {
                const element = elements[0];
                this.highlightDataPoint(chart, element);
            } else {
                this.resetHighlight(chart);
            }
        };
    }

    // Custom Animations
    addCustomAnimation(chart, type) {
        const animations = {
            fadeIn: {
                duration: 1000,
                easing: 'easeOutQuart',
                from: 0,
                to: 1
            },
            growUp: {
                duration: 1500,
                easing: 'easeInOutQuart',
                from: 0,
                to: 1,
                loop: false
            }
        };

        chart.options.animation = animations[type];
        chart.update();
    }

    // Event Handlers
    handleZoomEvent(chart, context) {
        const { chart: zoomChart } = context;
        // Handle zoom event
        if (this.eventHandlers.has('onZoom')) {
            this.eventHandlers.get('onZoom')(zoomChart);
        }
    }

    handlePanEvent(chart, context) {
        const { chart: panChart } = context;
        // Handle pan event
        if (this.eventHandlers.has('onPan')) {
            this.eventHandlers.get('onPan')(panChart);
        }
    }

    handleDrilldown(chart, element) {
        const drilldownData = this.getDrilldownData(chart, element);
        const interaction = this.customInteractions.get(chart.id);

        // Save current state
        interaction.drilldownStack.push({
            data: chart.data,
            options: chart.options
        });

        // Update chart with drilldown data
        chart.data = drilldownData.data;
        chart.options = {
            ...chart.options,
            ...drilldownData.options
        };

        interaction.currentLevel++;
        chart.update();
    }

    // Utility Methods
    getClickData(chart, element) {
        const datasetIndex = element.datasetIndex;
        const index = element.index;
        const dataset = chart.data.datasets[datasetIndex];

        return {
            label: chart.data.labels[index],
            value: dataset.data[index],
            dataset: dataset.label,
            datasetIndex,
            index
        };
    }

    getHoverData(chart, element) {
        return {
            ...this.getClickData(chart, element),
            x: element.element.x,
            y: element.element.y
        };
    }

    getDrilldownData(chart, element) {
        // Implementation depends on your data structure
        // Return new data and options for drilldown view
    }

    highlightDataset(chart, datasetIndex) {
        chart.data.datasets.forEach((dataset, index) => {
            const meta = chart.getDatasetMeta(index);
            meta.hidden = index !== datasetIndex;
        });
        chart.update();
    }

    highlightDataPoint(chart, element) {
        const { datasetIndex, index } = element;
        
        chart.data.datasets.forEach((dataset, i) => {
            dataset.data.forEach((_, j) => {
                const meta = chart.getDatasetMeta(i);
                const opacity = (i === datasetIndex && j === index) ? 1 : 0.3;
                meta.data[j].options.backgroundColor = this.adjustOpacity(
                    meta.data[j].options.backgroundColor,
                    opacity
                );
            });
        });
        
        chart.update();
    }

    resetHighlight(chart) {
        chart.data.datasets.forEach((dataset, i) => {
            dataset.data.forEach((_, j) => {
                const meta = chart.getDatasetMeta(i);
                meta.data[j].options.backgroundColor = this.adjustOpacity(
                    meta.data[j].options.backgroundColor,
                    1
                );
            });
        });
        
        chart.update();
    }

    adjustOpacity(color, opacity) {
        if (color.startsWith('rgba')) {
            return color.replace(/[\d.]+\)$/g, `${opacity})`);
        }
        return color;
    }
}

// Initialize Chart Interaction Manager
const chartInteractionManager = new ChartInteractionManager();

// Export Chart Interaction Manager
export { chartInteractionManager };

     
</script>
</html>

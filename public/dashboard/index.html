<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperAdmin Dashboard - WorkWise Pro</title>

    <!-- Updated Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@mui/material@5.14.13/umd/material-ui.production.min.js"></script>
    <script src="https://unpkg.com/@emotion/react@11.11.1/dist/emotion-react.umd.min.js"></script>
    <script src="https://unpkg.com/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Fonts and Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
        }

        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1a237e;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 30px;
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e3f2fd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1a237e;
        }

        .activity-details h4 {
            font-size: 0.9rem;
            color: #333;
        }

        .activity-details p {
            font-size: 0.8rem;
            color: #666;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 24px;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        .submenu {
            padding-left: 24px;
            background-color: rgba(0, 0, 0, 0.1);
        }

        .notification-badge {
            background-color: #f44336;
            color: white;
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 12px;
            position: absolute;
            top: 0;
            right: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { 
            AppBar, 
            Drawer, 
            List, 
            ListItem, 
            ListItemIcon, 
            ListItemText, 
            Typography,
            IconButton,
            Avatar,
            Menu,
            MenuItem,
            Box,
            CssBaseline,
            Toolbar,
            Collapse,
            Paper,
            Grid,
            Button,
            Divider,
            Badge
        } = MaterialUI;

        // Utility function to format numbers
        const formatNumber = (num) => {
            return new Intl.NumberFormat('en-US').format(num);
        };

        // Simple API service
        const apiService = {
            baseUrl: 'https://18.215.160.136.nip.io/api',
            
            async fetch(endpoint, options = {}) {
                const token = localStorage.getItem('token');
                const defaultOptions = {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                };

                try {
                    const response = await fetch(
                        `${this.baseUrl}${endpoint}`,
                        { ...defaultOptions, ...options }
                    );
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.message || 'API request failed');
                    }
                    
                    return data;
                } catch (error) {
                    console.error('API Error:', error);
                    throw error;
                }
            }
        };

        // DashboardStats Component
        const DashboardStats = () => {
            const [stats, setStats] = useState({
                totalCompanies: 0,
                activeUsers: 0,
                totalRevenue: 0,
                activeModules: 0
            });

            useEffect(() => {
                const fetchStats = async () => {
                    try {
                        const data = await apiService.fetch('/dashboard/stats');
                        if (data.success) {
                            setStats(data.stats);
                        }
                    } catch (error) {
                        console.error('Error fetching stats:', error);
                    }
                };

                fetchStats();
            }, []);

            return (
                <div className="stats-grid">
                    <div className="stat-card">
                        <h3>Total Companies</h3>
                        <div className="value">{formatNumber(stats.totalCompanies)}</div>
                    </div>
                    <div className="stat-card">
                        <h3>Active Users</h3>
                        <div className="value">{formatNumber(stats.activeUsers)}</div>
                    </div>
                    <div className="stat-card">
                        <h3>Total Revenue</h3>
                        <div className="value">${formatNumber(stats.totalRevenue)}</div>
                    </div>
                    <div className="stat-card">
                        <h3>Active Modules</h3>
                        <div className="value">{formatNumber(stats.activeModules)}</div>
                    </div>
                </div>
            );
        };

        // Sidebar Component
      // Update the Sidebar component's styles
const Sidebar = () => {
    const [menuItems, setMenuItems] = useState({
        dashboard: false,
        companies: false,
        'system-settings': false,
        modules: false,
        users: false,
        tools: false,
        support: false
    });

    const handleClick = (item) => {
        setMenuItems(prev => ({
            ...prev,
            [item]: !prev[item]
        }));
    };

    return (
        <Drawer
            variant="permanent"
            sx={{
                width: 240,
                flexShrink: 0,
                '& .MuiDrawer-paper': {
                    width: 240,
                    boxSizing: 'border-box',
                    backgroundColor: '#1a237e',
                    color: 'white'
                }
            }}
        >
            <Box sx={{ 
                p: 2, 
                textAlign: 'center', 
                borderBottom: '1px solid rgba(255,255,255,0.1)'
            }}>
                <Typography variant="h6">WorkWise Pro</Typography>
            </Box>
            <List sx={{ pt: 0 }}>
                {menuStructure.map((item) => (
                    <React.Fragment key={item.id}>
                        <ListItem 
                            button 
                            onClick={() => handleClick(item.id)}
                            sx={{
                                py: 1.5,
                                '&:hover': {
                                    backgroundColor: 'rgba(255,255,255,0.1)'
                                }
                            }}
                        >
                            <ListItemIcon sx={{ minWidth: 40, color: 'white' }}>
                                <i className={`fas fa-${item.icon}`} />
                            </ListItemIcon>
                            <ListItemText primary={item.title} />
                            {item.submenu && (
                                <i 
                                    className={`fas fa-chevron-${menuItems[item.id] ? 'down' : 'right'}`}
                                    style={{ fontSize: '12px' }}
                                />
                            )}
                        </ListItem>
                        {item.submenu && (
                            <Collapse in={menuItems[item.id]} timeout="auto" unmountOnExit>
                                <List component="div" disablePadding>
                                    {item.submenu.map((subItem, index) => (
                                        <ListItem 
                                            button 
                                            key={index}
                                            onClick={() => {
                                                if (subItem.path) {
                                                    window.location.href = subItem.path;
                                                }
                                            }}
                                            sx={{
                                                pl: 4,
                                                py: 1,
                                                backgroundColor: 'rgba(0,0,0,0.1)',
                                                '&:hover': {
                                                    backgroundColor: 'rgba(255,255,255,0.1)'
                                                }
                                            }}
                                        >
                                            <ListItemText 
                                                primary={subItem.title} 
                                                sx={{ 
                                                    '& .MuiTypography-root': { 
                                                        fontSize: '0.9rem' 
                                                    } 
                                                }}
                                            />
                                        </ListItem>
                                    ))}
                                </List>
                            </Collapse>
                        )}
                    </React.Fragment>
                ))}
            </List>
        </Drawer>
    );
};

        // Header Component
        const Header = () => {
            const [anchorEl, setAnchorEl] = useState(null);
            const [notifications, setNotifications] = useState([]);

            const handleMenu = (event) => {
                setAnchorEl(event.currentTarget);
            };

            const handleClose = () => {
                setAnchorEl(null);
            };

            const handleLogout = () => {
                localStorage.clear();
                window.location.href = '/login.html';
            };

            return (
                <AppBar 
                    position="fixed" 
                    sx={{ 
                        zIndex: theme => theme.zIndex.drawer + 1,
                        backgroundColor: 'white',
                        color: '#333'
                    }}
                >
                    <Toolbar>
                        <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                            Super Admin Dashboard
                        </Typography>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                            <IconButton color="inherit" sx={{ position: 'relative' }}>
                                <i className="fas fa-bell"></i>
                                {notifications.length > 0 && (
                                    <span className="notification-badge">
                                        {notifications.length}
                                    </span>
                                )}
                            </IconButton>
                            <IconButton
                                onClick={handleMenu}
                                color="inherit"
                            >
                                <Avatar sx={{ bgcolor: '#1a237e' }}>
                                    {(() => {
                                        const email = localStorage.getItem('userEmail');
                                        return email ? email.charAt(0).toUpperCase() : 'SA';
                                    })()}
                                </Avatar>
                            </IconButton>
                            <Menu
                                anchorEl={anchorEl}
                                open={Boolean(anchorEl)}
                                onClose={handleClose}
                            >
                                <MenuItem onClick={() => window.location.href = '/account.html'}>
                                    <i className="fas fa-user" style={{marginRight: '10px'}}></i>
                                    My Account
                                </MenuItem>
                                <MenuItem onClick={handleLogout}>
                                    <i className="fas fa-sign-out-alt" style={{marginRight: '10px'}}></i>
                                    Sign Out
                                </MenuItem>
                            </Menu>
                        </Box>
                    </Toolbar>
                </AppBar>
            );
        };

        // Main Dashboard Component
        const Dashboard = () => {
            useEffect(() => {
                const token = localStorage.getItem('token');
                if (!token) {
                    window.location.href = '/login.html';
                }
            }, []);

            return (
                <Box sx={{ display: 'flex' }}>
                    <CssBaseline />
                    <Header />
                    <Sidebar />
                    <Box
                        component="main"
                        sx={{
                            flexGrow: 1,
                            p: 3,
                            mt: 8,
                            ml: '240px'
                        }}
                    >
                        <DashboardStats />
                        <Grid container spacing={3}>
                            <Grid item xs={12}>
                                <Paper sx={{ p: 2, height: '400px' }}>
                                    <Typography variant="h6" gutterBottom>
                                        System Analytics
                                    </Typography>
                                    <canvas id="systemAnalytics"></canvas>
                                </Paper>
                            </Grid>
                        </Grid>
                    </Box>
                </Box>
            );
        };

        // Initialize Chart.js
        const initializeChart = () => {
            const ctx = document.getElementById('systemAnalytics');
            if (ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'System Usage',
                            data: [65, 59, 80, 81, 56, 55],
                            fill: false,
                            borderColor: '#1a237e',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);

        // Initialize chart after render
        setTimeout(initializeChart, 1000);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperAdmin Dashboard - WorkWise Pro</title>

    <!-- React Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <!-- Material-UI Dependencies -->
    <script src="https://unpkg.com/@mui/material@latest/umd/material-ui.development.js"></script>
    <script src="https://unpkg.com/@mui/icons-material@latest/index.js"></script>
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Fonts and Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
        }

        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1a237e;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 30px;
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e3f2fd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1a237e;
        }

        .activity-details h4 {
            font-size: 0.9rem;
            color: #333;
        }

        .activity-details p {
            font-size: 0.8rem;
            color: #666;
        }

        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #f44336;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { 
            AppBar, 
            Drawer, 
            List, 
            ListItem, 
            ListItemIcon, 
            ListItemText, 
            Typography,
            IconButton,
            Avatar,
            Menu,
            MenuItem,
            Box,
            CssBaseline,
            Toolbar,
            Collapse,
            Paper,
            Grid,
            Button,
            Divider,
            Badge
        } = MaterialUI;

        // Utility function to format numbers
        const formatNumber = (num) => {
            return new Intl.NumberFormat('en-US').format(num);
        };

        // Dashboard Stats Component
        const DashboardStats = () => {
            const [stats, setStats] = useState({
                totalCompanies: 0,
                activeUsers: 0,
                totalRevenue: 0,
                activeModules: 0
            });

            useEffect(() => {
                // Fetch stats from API
                const fetchStats = async () => {
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch('https://18.215.160.136.nip.io/api/dashboard/stats', {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            setStats(data.stats);
                        }
                    } catch (error) {
                        console.error('Error fetching stats:', error);
                    }
                };

                fetchStats();
            }, []);

            return (
                <div className="stats-grid">
                    <div className="stat-card">
                        <h3>Total Companies</h3>
                        <div className="value">{formatNumber(stats.totalCompanies)}</div>
                    </div>
                    <div className="stat-card">
                        <h3>Active Users</h3>
                        <div className="value">{formatNumber(stats.activeUsers)}</div>
                    </div>
                    <div className="stat-card">
                        <h3>Total Revenue</h3>
                        <div className="value">${formatNumber(stats.totalRevenue)}</div>
                    </div>
                    <div className="stat-card">
                        <h3>Active Modules</h3>
                        <div className="value">{formatNumber(stats.activeModules)}</div>
                    </div>
                </div>
            );
        };

        // Recent Activity Component
        const RecentActivity = () => {
            const [activities, setActivities] = useState([]);

            useEffect(() => {
                // Fetch recent activities
                const fetchActivities = async () => {
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch('https://18.215.160.136.nip.io/api/activities', {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            setActivities(data.activities);
                        }
                    } catch (error) {
                        console.error('Error fetching activities:', error);
                    }
                };

                fetchActivities();
            }, []);

            return (
                <div className="dashboard-card">
                    <Typography variant="h6" gutterBottom>
                        Recent Activity
                    </Typography>
                    <List className="activity-list">
                        {activities.map((activity, index) => (
                            <ListItem key={index} className="activity-item">
                                <div className="activity-icon">
                                    <i className={`fas fa-${activity.icon}`}></i>
                                </div>
                                <div className="activity-details">
                                    <Typography variant="subtitle2">{activity.action}</Typography>
                                    <Typography variant="body2" color="textSecondary">
                                        {activity.timestamp}
                                    </Typography>
                                </div>
                            </ListItem>
                        ))}
                    </List>
                </div>
            );
        };

        // Sidebar Component
        const Sidebar = () => {
            const [menuItems, setMenuItems] = useState({
                dashboard: true,
                companies: false,
                settings: false,
                modules: false,
                users: false,
                tools: false,
                support: false
            });

            const handleClick = (item) => {
                setMenuItems(prev => ({
                    ...prev,
                    [item]: !prev[item]
                }));
            };

            const menuStructure = [
                {
                    id: 'dashboard',
                    title: 'Dashboard Overview',
                    icon: 'tachometer-alt',
                    path: '/dashboard'
                },
                {
                    id: 'companies',
                    title: 'Companies/Organizations',
                    icon: 'building',
                    submenu: [
                        { title: 'Companies List', path: '/companies/list' },
                        { title: 'Management', path: '/companies/management' }
                    ]
                },
                {
                    id: 'settings',
                    title: 'System Settings',
                    icon: 'cogs',
                    submenu: [
                        { title: 'General Settings', path: '/settings/general' },
                        { title: 'Pricing & Plans', path: '/settings/pricing' },
                        { title: 'Security Settings', path: '/settings/security' }
                    ]
                },
                {
                    id: 'modules',
                    title: 'Modules Management',
                    icon: 'puzzle-piece',
                    submenu: [
                        { title: 'Modules List', path: '/modules/list' },
                        { title: 'Module Settings', path: '/modules/settings' }
                    ]
                },
                {
                    id: 'users',
                    title: 'User Management',
                    icon: 'users',
                    submenu: [
                        { title: 'Users List', path: '/users/list' },
                        { title: 'Roles & Permissions', path: '/users/roles' },
                        { title: 'Organization Chart', path: '/users/org-chart' }
                    ]
                },
                {
                    id: 'tools',
                    title: 'Tools',
                    icon: 'tools',
                    submenu: [
                        { title: 'Analytics & Reports', path: '/tools/analytics' },
                        { title: 'Backup & Restore', path: '/tools/backup' },
                        { title: 'Audit Logs', path: '/tools/audit-logs' },
                        { title: 'API Management', path: '/tools/api' }
                    ]
                },
                {
                    id: 'support',
                    title: 'Support',
                    icon: 'headset',
                    path: '/support'
                }
            ];

            return (
                <Drawer
                    variant="permanent"
                    sx={{
                        width: 240,
                        flexShrink: 0,
                        '& .MuiDrawer-paper': {
                            width: 240,
                            boxSizing: 'border-box',
                            backgroundColor: '#1a237e',
                            color: 'white'
                        }
                    }}
                >
                    <Box sx={{ p: 2, textAlign: 'center' }}>
                        <Typography variant="h6">WorkWise Pro</Typography>
                    </Box>
                    <List>
                        {menuStructure.map((item) => (
                            <React.Fragment key={item.id}>
                                <ListItem 
                                    button 
                                    onClick={() => handleClick(item.id)}
                                    sx={{
                                        backgroundColor: menuItems[item.id] ? 'rgba(255,255,255,0.1)' : 'transparent'
                                    }}
                                >
                                    <ListItemIcon>
                                        <i className={`fas fa-${item.icon}`} style={{color: 'white'}} />
                                    </ListItemIcon>
                                    <ListItemText primary={item.title} />
                                    {item.submenu && (
                                        <i className={`fas fa-chevron-${menuItems[item.id] ? 'up' : 'down'}`} 
                                           style={{color: 'white'}} />
                                    )}
                                </ListItem>
                                {item.submenu && (
                                    <Collapse in={menuItems[item.id]}>
                                        <List component="div" disablePadding>
                                            {item.submenu.map((subItem, index) => (
                                                <ListItem 
                                                    button 
                                                    key={index}
                                                    sx={{ pl: 4 }}
                                                    onClick={() => {
                                                        if (subItem.path) {
                                                            window.location.href = subItem.path;
                                                        }
                                                    }}
                                                >
                                                    <ListItemText primary={subItem.title} />
                                                </ListItem>
                                            ))}
                                        </List>
                                    </Collapse>
                                )}
                            </React.Fragment>
                        ))}
                    </List>
                </Drawer>
            );
        };

        // Header Component
        const Header = () => {
            const [anchorEl, setAnchorEl] = useState(null);
            const [notifications, setNotifications] = useState([]);

            useEffect(() => {
                // Fetch notifications
                const fetchNotifications = async () => {
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch('https://18.215.160.136.nip.io/api/notifications', {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        const data = await response.json();
                        if (data.success) {
                            setNotifications(data.notifications);
                        }
                    } catch (error) {
                        console.error('Error fetching notifications:', error);
                    }
                };

                fetchNotifications();
            }, []);

            const handleMenu = (event) => {
                setAnchorEl(event.currentTarget);
            };

            const handleClose = () => {
                setAnchorEl(null);
            };

            const handleLogout = async () => {
                try {
                    const token = localStorage.getItem('token');
                    await fetch('https://18.215.160.136.nip.io/api/logout', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    localStorage.clear();
                    window.location.href = '/login.html';
                } catch (error) {
                    console.error('Logout error:', error);
                }
            };

            return (
                <AppBar 
                    position="fixed" 
                    sx={{ 
                        zIndex: theme => theme.zIndex.drawer + 1,
                        backgroundColor: 'white',
                        color: '#333'
                    }}
                >
                    <Toolbar>
                        <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                            Super Admin Dashboard
                        </Typography>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                            <IconButton color="inherit" sx={{ position: 'relative' }}>
                                <Badge badgeContent={notifications.length} color="error">
                                    <i className="fas fa-bell"></i>
                                </Badge>
                            </IconButton>
                            <IconButton
                                size="large"
                                onClick={handleMenu}
                                color="inherit"
                            >
                                <Avatar sx={{ bgcolor: '#1a237e' }}>
                                    {localStorage.getItem('userEmail')?.charAt(0).toUpperCase() || 'SA'}
                                </Avatar>
                            </IconButton>
                            <Menu
                                anchorEl={anchorEl}
                                open={Boolean(anchorEl)}
                                onClose={handleClose}
                            >
                                <MenuItem onClick={() => window.location.href = '/account.html'}>
                                    <i className="fas fa-user" style={{marginRight: '10px'}}></i>
                                    My Account
                                </MenuItem>
                                <MenuItem onClick={handleLogout}>
                                    <i className="fas fa-sign-out-alt" style={{marginRight: '10px'}}></i>
                                    Sign Out
                                </MenuItem>
                            </Menu>
                        </Box>
                    </Toolbar>
                </AppBar>
            );
        };

        // Main Dashboard Component
        const Dashboard = () => {
            useEffect(() => {
                // Check authentication
                const token = localStorage.getItem('token');
                if (!token) {
                    window.location.href = '/login.html';
                    return;
                }

                // Verify token
                const verifyToken = async () => {
                    try {
                        const response = await fetch('https://18.215.160.136.nip.io/api/verify-token', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        const data = await response.json();
                        if (!data.success) {
                            localStorage.clear();
                            window.location.href = '/login.html';
                        }
                    } catch (error) {
                        console.error('Token verification error:', error);
                        localStorage.clear();
                        window.location.href = '/login.html';
                    }
                };

                verifyToken();
            }, []);

            return (
                <Box sx={{ display: 'flex' }}>
                    <CssBaseline />
                    <Header />
                    <Sidebar />
                    <Box
                        component="main"
                        sx={{
                            flexGrow: 1,
                            p: 3,
                            mt: 8,
                            ml: '240px'
                        }}
                    >
                        <DashboardStats />
                        <Grid container spacing={3}>
                            <Grid item xs={12} md={8}>
                                <Paper sx={{ p: 2, height: '400px' }}>
                                    <Typography variant="h6" gutterBottom>
                                        System Analytics
                                    </Typography>
                                    <div className="chart-container">
                                        {/* Chart.js implementation will go here */}
                                    </div>
                                </Paper>
                            </Grid>
                            <Grid item xs={12} md={4}>
                                <RecentActivity />
                            </Grid>
                        </Grid>
                    </Box>
                </Box>
            );
        };

        // Initialize Chart.js
        useEffect(() => {
            const ctx = document.getElementById('systemAnalytics');
            if (ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'System Usage',
                            data: [65, 59, 80, 81, 56, 55],
                            fill: false,
                            borderColor: '#1a237e',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }, []);

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>
</html>

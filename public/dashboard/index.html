<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperAdmin Dashboard - WorkWise Pro</title>

    <!-- Updated Dependencies -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@mui/material@5.14.13/umd/material-ui.production.min.js"></script>
    <script src="https://unpkg.com/@emotion/react@11.11.1/dist/emotion-react.umd.min.js"></script>
    <script src="https://unpkg.com/@emotion/styled@11.11.0/dist/emotion-styled.umd.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Fonts and Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
        }

        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1a237e;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 30px;
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e3f2fd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1a237e;
        }

        .activity-details h4 {
            font-size: 0.9rem;
            color: #333;
        }

        .activity-details p {
            font-size: 0.8rem;
            color: #666;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 24px;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        .submenu {
            padding-left: 24px;
            background-color: rgba(0, 0, 0, 0.1);
        }

        .notification-badge {
            background-color: #f44336;
            color: white;
            border-radius: 50%;
            padding: 4px 8px;
            font-size: 12px;
            position: absolute;
            top: 0;
            right: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { 
            AppBar, 
            Drawer, 
            List, 
            ListItem, 
            ListItemIcon, 
            ListItemText, 
            Typography,
            IconButton,
            Avatar,
            Menu,
            MenuItem,
            Box,
            CssBaseline,
            Toolbar,
            Collapse,
            Paper,
            Grid,
            Button,
            Divider,
            Badge
        } = MaterialUI;

        // Utility function to format numbers
        const formatNumber = (num) => {
            return new Intl.NumberFormat('en-US').format(num);
        };

        // Simple API service
       // API Service with actual user endpoints and mock data for others
const apiService = {
    baseUrl: 'https://18.215.160.136.nip.io/api',
    
    async fetch(endpoint, options = {}) {
        const token = localStorage.getItem('token');
        const defaultOptions = {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json',
            },
        };

        try {
            // User-related endpoints from your server.js
            if (endpoint.startsWith('/users') || 
                endpoint === '/verify-token' || 
                endpoint === '/login' || 
                endpoint === '/register') {
                
                const response = await fetch(
                    `${this.baseUrl}${endpoint}`,
                    { ...defaultOptions, ...options }
                );

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return await response.json();
            }

            // Mock data for other endpoints
            return this.getMockData(endpoint);
        } catch (error) {
            console.error('API Error:', error);
            throw error;
        }
    },

    // Mock data provider
    getMockData(endpoint) {
        switch (endpoint) {
            case '/dashboard/stats':
                return {
                    success: true,
                    stats: {
                        totalCompanies: 150,
                        activeUsers: 1250,
                        totalRevenue: 125000,
                        activeModules: 25
                    }
                };

            case '/activities':
                return {
                    success: true,
                    activities: [
                        {
                            id: 1,
                            action: 'New company registered',
                            timestamp: '2 minutes ago',
                            icon: 'building'
                        },
                        {
                            id: 2,
                            action: 'User role updated',
                            timestamp: '5 minutes ago',
                            icon: 'user-cog'
                        },
                        {
                            id: 3,
                            action: 'System backup completed',
                            timestamp: '15 minutes ago',
                            icon: 'database'
                        },
                        {
                            id: 4,
                            action: 'New module activated',
                            timestamp: '1 hour ago',
                            icon: 'puzzle-piece'
                        }
                    ]
                };

            case '/notifications':
                return {
                    success: true,
                    notifications: [
                        {
                            id: 1,
                            message: 'System update available',
                            type: 'info',
                            timestamp: new Date().toISOString()
                        },
                        {
                            id: 2,
                            message: 'New user registration',
                            type: 'success',
                            timestamp: new Date().toISOString()
                        }
                    ]
                };

            default:
                return {
                    success: false,
                    message: 'Endpoint not implemented'
                };
        }
    }
};

        // DashboardStats Component
       const DashboardStats = () => {
    const [stats, setStats] = useState({
        totalCompanies: 0,
        activeUsers: 0,
        totalRevenue: 0,
        activeModules: 0
    });

    useEffect(() => {
        const fetchStats = async () => {
            try {
                const data = await apiService.fetch('/dashboard/stats');
                if (data.success) {
                    setStats(data.stats);
                }
            } catch (error) {
                console.error('Error fetching stats:', error);
                // Keep using initial state if API fails
            }
        };

        fetchStats();
    }, []);

    return (
        <div className="stats-grid">
            <div className="stat-card">
                <h3>Total Companies</h3>
                <div className="value">{formatNumber(stats.totalCompanies)}</div>
            </div>
            <div className="stat-card">
                <h3>Active Users</h3>
                <div className="value">{formatNumber(stats.activeUsers)}</div>
            </div>
            <div className="stat-card">
                <h3>Total Revenue</h3>
                <div className="value">${formatNumber(stats.totalRevenue)}</div>
            </div>
            <div className="stat-card">
                <h3>Active Modules</h3>
                <div className="value">{formatNumber(stats.activeModules)}</div>
            </div>
        </div>
    );
};
        // Sidebar Component
   const Sidebar = () => {
    const [isCollapsed, setIsCollapsed] = useState(false);
    const [menuItems, setMenuItems] = useState({
        dashboard: false,
        companies: false,
        'system-settings': false,
        modules: false,
        users: false,
        tools: false,
        support: false
    });

    const drawerWidth = isCollapsed ? 65 : 240;

    const menuStructure = [
        {
            id: 'dashboard',
            title: 'Dashboard Overview',
            icon: 'tachometer-alt',
            path: '/dashboard'
        },
        {
            id: 'companies',
            title: 'Companies/Organizations',
            icon: 'building',
            submenu: [
                { title: 'Management', path: '/companies/management' },
                { title: 'Companies/Organizations', path: '/companies/list' }
            ]
        },
        {
            id: 'system-settings',
            title: 'System Settings',
            icon: 'cogs',
            submenu: [
                { title: 'General Settings', path: '/settings/general' },
                { title: 'Pricing & Plans', path: '/settings/pricing' },
                { title: 'Security Settings', path: '/settings/security' }
            ]
        },
        {
            id: 'modules',
            title: 'Modules Management',
            icon: 'puzzle-piece',
            submenu: [
                { title: 'Modules List', path: '/modules/list' },
                { title: 'Module Settings', path: '/modules/settings' }
            ]
        },
        {
            id: 'users',
            title: 'User Management',
            icon: 'users',
            submenu: [
                { title: 'Users List', path: '/users/list' },
                { title: 'Roles & Permissions', path: '/users/roles' },
                { title: 'Organization Chart', path: '/users/org-chart' }
            ]
        },
        {
            id: 'tools',
            title: 'Tools',
            icon: 'tools',
            submenu: [
                { title: 'Analytics & Reports', path: '/tools/analytics' },
                { title: 'Backup & Restore', path: '/tools/backup' },
                { title: 'Audit Logs', path: '/tools/audit' },
                { title: 'API Management', path: '/tools/api' }
            ]
        },
        {
            id: 'support',
            title: 'Support',
            icon: 'headset',
            submenu: [
                { title: 'Support Center', path: '/support/center' }
            ]
        }
    ];

    const handleClick = (item) => {
        if (!isCollapsed) {
            setMenuItems(prev => ({
                ...prev,
                [item]: !prev[item]
            }));
        }
    };

    return (
        <Drawer
            variant="permanent"
            sx={{
                width: drawerWidth,
                flexShrink: 0,
                transition: 'width 0.3s ease',
                '& .MuiDrawer-paper': {
                    width: drawerWidth,
                    boxSizing: 'border-box',
                    backgroundColor: '#1a237e',
                    color: 'white',
                    transition: 'width 0.3s ease',
                    overflowX: 'hidden',
                    position: 'relative'
                }
            }}
        >
            <Box sx={{ 
                p: 2, 
                textAlign: 'center', 
                borderBottom: '1px solid rgba(255,255,255,0.1)',
                display: 'flex',
                alignItems: 'center',
                justifyContent: isCollapsed ? 'center' : 'space-between'
            }}>
                {!isCollapsed && <Typography variant="h6">WorkWise Pro</Typography>}
                <IconButton 
                    onClick={() => setIsCollapsed(!isCollapsed)}
                    sx={{ 
                        color: 'white',
                        padding: '4px',
                        '&:hover': { backgroundColor: 'rgba(255,255,255,0.1)' }
                    }}
                >
                    <i className={`fas fa-chevron-${isCollapsed ? 'right' : 'left'}`} />
                </IconButton>
            </Box>
            <List sx={{ pt: 0 }}>
                {menuStructure.map((item) => (
                    <React.Fragment key={item.id}>
                        <ListItem 
                            button 
                            onClick={() => handleClick(item.id)}
                            sx={{
                                py: 1.5,
                                minHeight: 48,
                                px: 2.5,
                                '&:hover': {
                                    backgroundColor: 'rgba(255,255,255,0.1)'
                                }
                            }}
                        >
                            <ListItemIcon 
                                sx={{ 
                                    minWidth: isCollapsed ? 'auto' : 40, 
                                    color: 'white',
                                    justifyContent: 'center'
                                }}
                            >
                                <i className={`fas fa-${item.icon}`} />
                            </ListItemIcon>
                            {!isCollapsed && (
                                <>
                                    <ListItemText primary={item.title} />
                                    {item.submenu && (
                                        <i 
                                            className={`fas fa-chevron-${menuItems[item.id] ? 'down' : 'right'}`}
                                            style={{ fontSize: '12px' }}
                                        />
                                    )}
                                </>
                            )}
                        </ListItem>
                        {!isCollapsed && item.submenu && (
                            <Collapse in={menuItems[item.id]} timeout="auto" unmountOnExit>
                                <List component="div" disablePadding>
                                    {item.submenu.map((subItem, index) => (
                                        <ListItem 
                                            button 
                                            key={index}
                                            onClick={() => {
                                                if (subItem.path) {
                                                    window.location.href = subItem.path;
                                                }
                                            }}
                                            sx={{
                                                pl: 4,
                                                py: 1,
                                                backgroundColor: 'rgba(0,0,0,0.1)',
                                                '&:hover': {
                                                    backgroundColor: 'rgba(255,255,255,0.1)'
                                                }
                                            }}
                                        >
                                            <ListItemText 
                                                primary={subItem.title} 
                                                sx={{ 
                                                    '& .MuiTypography-root': { 
                                                        fontSize: '0.9rem' 
                                                    } 
                                                }}
                                            />
                                        </ListItem>
                                    ))}
                                </List>
                            </Collapse>
                        )}
                    </React.Fragment>
                ))}
            </List>
        </Drawer>
    );
};

        // Header Component
        const Header = () => {
            const [anchorEl, setAnchorEl] = useState(null);
            const [notifications, setNotifications] = useState([]);

            const handleMenu = (event) => {
                setAnchorEl(event.currentTarget);
            };

            const handleClose = () => {
                setAnchorEl(null);
            };

            const handleLogout = () => {
                localStorage.clear();
                window.location.href = '/login.html';
            };

            return (
                <AppBar 
                    position="fixed" 
                    sx={{ 
                        zIndex: theme => theme.zIndex.drawer + 1,
                        backgroundColor: 'white',
                        color: '#333'
                    }}
                >
                    <Toolbar>
                        <Typography variant="h6" component="div" sx={{ flexGrow: 1 }}>
                            Super Admin Dashboard
                        </Typography>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                            <IconButton color="inherit" sx={{ position: 'relative' }}>
                                <i className="fas fa-bell"></i>
                                {notifications.length > 0 && (
                                    <span className="notification-badge">
                                        {notifications.length}
                                    </span>
                                )}
                            </IconButton>
                            <IconButton
                                onClick={handleMenu}
                                color="inherit"
                            >
                                <Avatar sx={{ bgcolor: '#1a237e' }}>
                                    {(() => {
                                        const email = localStorage.getItem('userEmail');
                                        return email ? email.charAt(0).toUpperCase() : 'SA';
                                    })()}
                                </Avatar>
                            </IconButton>
                            <Menu
                                anchorEl={anchorEl}
                                open={Boolean(anchorEl)}
                                onClose={handleClose}
                            >
                                <MenuItem onClick={() => window.location.href = '/account.html'}>
                                    <i className="fas fa-user" style={{marginRight: '10px'}}></i>
                                    My Account
                                </MenuItem>
                                <MenuItem onClick={handleLogout}>
                                    <i className="fas fa-sign-out-alt" style={{marginRight: '10px'}}></i>
                                    Sign Out
                                </MenuItem>
                            </Menu>
                        </Box>
                    </Toolbar>
                </AppBar>
            );
        };

        // Main Dashboard Component
       const Dashboard = () => {
    const [isCollapsed, setIsCollapsed] = useState(false);
    
    useEffect(() => {
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = '/login.html';
        }
    }, []);

    return (
        <Box sx={{ display: 'flex' }}>
            <CssBaseline />
            <Header />
            <Sidebar isCollapsed={isCollapsed} setIsCollapsed={setIsCollapsed} />
            <Box
                component="main"
                sx={{
                    flexGrow: 1,
                    p: 3,
                    mt: 8,
                    ml: isCollapsed ? '65px' : '240px',
                    transition: 'margin-left 0.3s ease'
                }}
            >
                <DashboardStats />
                <Grid container spacing={3}>
                    <Grid item xs={12}>
                        <Paper sx={{ p: 2, height: '400px' }}>
                            <Typography variant="h6" gutterBottom>
                                System Analytics
                            </Typography>
                            <canvas id="systemAnalytics"></canvas>
                        </Paper>
                    </Grid>
                </Grid>
            </Box>
        </Box>
    );
};

        // Initialize Chart.js
        const initializeChart = () => {
            const ctx = document.getElementById('systemAnalytics');
            if (ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'System Usage',
                            data: [65, 59, 80, 81, 56, 55],
                            fill: false,
                            borderColor: '#1a237e',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);

        // Initialize chart after render
        setTimeout(initializeChart, 1000);
    </script>
</body>
</html>
